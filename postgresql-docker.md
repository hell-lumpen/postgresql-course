# Подробная инструкция по Docker для начинающих

## 1. Что такое Docker?

**Docker** — это инструмент, позволяющий разработчикам создавать, развертывать и запускать приложения в изолированных средах, называемых **контейнерами**. Контейнеры обеспечивают легкую и быструю изоляцию приложений, используя общее ядро операционной системы, что делает их более эффективными по сравнению с традиционными виртуальными машинами.

### Преимущества Docker
- **Изоляция приложений:** Каждое приложение работает в своем контейнере, предотвращая конфликты зависимостей.
- **Портативность:** Контейнеры могут работать на любом сервере, поддерживающем Docker.
- **Эффективность:** Контейнеры запускаются быстрее и требуют меньше ресурсов.

## 2. Основные термины Docker

- **Контейнер:** Изолированная среда, где запускается приложение. Контейнеры создаются из образов.
- **Образ (Image):** Шаблон для создания контейнеров, включающий необходимые файлы и настройки.
- **Dockerfile:** Текстовый файл с инструкциями для создания образа.
- **Docker Hub:** Облачный сервис для хранения и обмена образами.
- **Volume:** Механизм для хранения данных вне контейнера, позволяющий сохранять данные при его удалении.
- **Docker Compose:** Инструмент для управления многоконтейнерными приложениями.

## 3. Установка Docker

1. **Скачайте и установите Docker:**
   - Для **Windows** и **macOS** используйте [Docker Desktop](https://www.docker.com/products/docker-desktop).
   - Для **Linux** следуйте инструкциям на [официальном сайте Docker](https://docs.docker.com/get-docker/).

2. **Проверьте установку:**
   Откройте терминал и введите:
   ```bash
   docker --version
   ```
   Если установка успешна, вы увидите версию Docker.

## 4. Основные команды Docker

- **Список контейнеров:**
  ```bash
  docker ps
  ```
  Для отображения всех контейнеров (включая остановленные):
  ```bash
  docker ps -a
  ```

- **Запуск контейнера:**
  ```bash
  docker run [OPTIONS] IMAGE
  ```

- **Остановка контейнера:**
  ```bash
  docker stop CONTAINER_ID
  ```

- **Удаление контейнера:**
  ```bash
  docker rm CONTAINER_ID
  ```

- **Сборка образа из Dockerfile:**
  ```bash
  docker build -t IMAGE_NAME .
  ```

- **Загрузка образа на Docker Hub:**
  ```bash
  docker push IMAGE_NAME
  ```

- **Загрузка образа с Docker Hub:**
  ```bash
  docker pull IMAGE_NAME
  ```

## 5. Создание контейнера с PostgreSQL

### Шаг 1: Запуск контейнера с PostgreSQL

1. **Откройте терминал.**

2. **Создайте и запустите контейнер:**
   ```bash
   docker run --name my-postgres -e POSTGRES_USER=myuser -e POSTGRES_PASSWORD=mypassword -d -p 5432:5432 postgres
   ```
   - `--name my-postgres`: задает имя контейнера.
   - `-e POSTGRES_USER=myuser`: задает имя пользователя для PostgreSQL.
   - `-e POSTGRES_PASSWORD=mypassword`: задает пароль для пользователя.
   - `-d`: запускает контейнер в фоновом режиме.
   - `-p 5432:5432`: пробрасывает порт для доступа к PostgreSQL.

3. **Проверьте запуск контейнера:**
   ```bash
   docker ps
   ```

### Шаг 2: Утилита psql и ее возможности

**psql** — это интерактивная командная строка для работы с PostgreSQL. Она позволяет выполнять SQL-запросы, управлять базами данных и получать информацию о них. Вот некоторые основные возможности psql:

- **Выполнение SQL-запросов:** Вы можете вводить любые SQL-команды, такие как создание таблиц, вставка данных и выборка информации.
  
- **Работа с базами данных:** psql позволяет создавать, удалять и управлять базами данных. Вы можете переключаться между ними с помощью команды `\c` (connect).

- **Получение информации о структуре базы данных:** Команды, начинающиеся с `\`, позволяют получать информацию о базах данных, таблицах и других объектах. Например:
  - `\dt` — показать все таблицы в текущей базе данных.
  - `\d имя_таблицы` — показать структуру конкретной таблицы.

- **Импорт и экспорт данных:** psql поддерживает команды для загрузки данных из файлов (`\copy`) и сохранения данных в файлы.

- **Скрипты:** Вы можете выполнять SQL-скрипты, используя команду `\i имя_файла`.

- **Подсказки и автозавершение:** psql поддерживает автозавершение команд, что делает его использование более удобным.

### Пример подключения к psql

Чтобы подключиться к PostgreSQL через psql, выполните следующую команду:

```bash
psql -h localhost -U myuser -d postgres
```

- `-h localhost`: указывает адрес сервера (localhost для локального подключения).
- `-U myuser`: имя пользователя, заданное при создании контейнера.
- `-d postgres`: имя базы данных, к которой вы хотите подключиться (по умолчанию `postgres`).

После выполнения команды введите пароль (`mypassword`), когда будет предложено. Теперь вы можете работать с базой данных через psql.

### Работа с psql из контейнера

Чтобы запустить psql из контейнера, используйте команду `docker exec`:

```bash
docker exec -it my-postgres psql -U myuser -d postgres
```

- `-it`: позволяет взаимодействовать с контейнером.
- `my-postgres`: имя вашего контейнера.
- `psql -U myuser -d postgres`: команда для подключения к PostgreSQL.

## 6. Остановка и удаление контейнера

1. **Остановка контейнера:**
   ```bash
   docker stop my-postgres
   ```

2. **Удаление контейнера:**
   ```bash
   docker rm my-postgres
   ```

## Важное уведомление

**Если вы сталкиваетесь с ошибкой при попытке подключения:**

```
PostgresException (0x80004005): 28P01: password authentication failed for user "xxxxxxx"
```

1. **Проверьте все логины, пароли и имя базы данных.**

2. **Удалите PostgreSQL, установленный на вашей системе.**

3. **Либо измените проброс портов, например, на `5433:5432`, если порт 5432 уже занят установленным локально PostgreSQL.**

## Заключение

Вы узнали о Docker, его преимуществах, основных терминах, установке, командах и создании контейнера с PostgreSQL. Используйте эту информацию для эффективного управления базами данных и приложениями в Docker. Если возникнут вопросы, обращайтесь к документации Docker или PostgreSQL.
